#!/usr/bin/env bash

set -e

build_dir="$1"
cache_dir="$2"
bp_dir="$(dirname "$(dirname "$0")")"
bundler_version="1.14.6"

export GEM_HOME="$cache_dir"
export GEM_PATH="$cache_dir"
gem install bundler --no-document --version "$bundler_version"

bundle="$GEM_HOME/bin/bundle"
gemfile="$bp_dir/Gemfile"
"$bundle" install --gemfile="$gemfile" --system

cd "$build_dir"
env BUNDLE_GEMFILE="$gemfile" "$bundle" exec jekyll build --quiet --trace
